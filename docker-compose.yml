services:
  mysql:
    image: mysql:8.0
    container_name: ps-mysql
    command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: prestashop
      MYSQL_USER: prestashop
      MYSQL_PASSWORD: prestashop123
    volumes:
      - mysql-data:/var/lib/mysql
      - ./php.ini:/usr/local/etc/php/conf.d/custom.ini
    ports:
      - "3307:3306"

  web:
    image: php:8.1-apache
    container_name: ps-web
    depends_on:
      mysql:
        condition: service_started
    ports:
      - "8080:80"
    volumes:
      # THIS IS THE IMPORTANT LINE â†’ mounts your local folder directly
      - .:/var/www/html
    working_dir: /var/www/html
    command:
      - bash
      - -c
      - |
        apt-get update -qq
        apt-get install -y --no-install-recommends unzip libzip-dev libpng-dev libjpeg-dev libfreetype6-dev libicu-dev > /dev/null 2>&1
        docker-php-ext-configure gd --with-freetype --with-jpeg
        docker-php-ext-install -j$(nproc) mysqli pdo_mysql zip gd intl bcmath > /dev/null 2>&1
        echo "short_open_tag = Off" > /usr/local/etc/php/conf.d/custom.ini
        echo "date.timezone = Europe/Paris" >> /usr/local/etc/php/conf.d/custom.ini
        a2enmod rewrite > /dev/null

        apache2-foreground

volumes:
  mysql-data:
